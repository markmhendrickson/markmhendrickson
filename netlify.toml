[build]
  base = "."
  command = "npm run build"
  publish = "react-app/dist"
  functions = "netlify/functions"

# Redirect TLD JSON to canonical /api/ paths (absolute URLs in mcp.json use /api/)
[[redirects]]
  from = "/timeline.json"
  to = "/api/timeline.json"
  status = 302
[[redirects]]
  from = "/posts.json"
  to = "/api/posts.json"
  status = 302
[[redirects]]
  from = "/links.json"
  to = "/api/links.json"
  status = 302
[[redirects]]
  from = "/agent.json"
  to = "/api/agent.json"
  status = 302

# Permanent redirect: old /social path to /links
[[redirects]]
  from = "/social"
  to = "/links"
  status = 301

# Rewrite /api/newsletter/* to Netlify functions
[[redirects]]
  from = "/api/newsletter/subscribe"
  to = "/.netlify/functions/newsletter_subscribe"
  status = 200
  force = true

[[redirects]]
  from = "/api/newsletter/update-survey"
  to = "/.netlify/functions/newsletter_update_survey"
  status = 200
  force = true

[[redirects]]
  from = "/api/newsletter/confirm"
  to = "/.netlify/functions/newsletter_confirm"
  status = 200
  force = true

[[redirects]]
  from = "/api/newsletter/subscribers"
  to = "/.netlify/functions/newsletter_subscribers"
  status = 200
  force = true
